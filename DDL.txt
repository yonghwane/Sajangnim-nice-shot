DROP TABLE MEMBERS CASCADE CONSTRAINTS;
DROP TABLE PRICES CASCADE CONSTRAINTS;
DROP TABLE TIMESLOTS CASCADE CONSTRAINTS;
DROP TABLE RSVDS CASCADE CONSTRAINTS;
DROP SEQUENCE PRI_CODE;
DROP SEQUENCE RSV_CODE;
DROP SEQUENCE TI_CODE;

--SELECT * FROM ALL_TRIGGERS WHERE TRIGGER_NAME = 'RSVDS_AFTER_INSERT';

CREATE TABLE MEMBERS (
    MEM_NICKNAME VARCHAR2(15) PRIMARY KEY NOT NULL
);

CREATE TABLE PRICES (
    PRI_CODE NUMBER(1) PRIMARY KEY,
    PRI_OPTION VARCHAR2(15) NOT NULL,
    PRI_PRICE NUMBER(8) NOT NULL
);

CREATE TABLE RSVDS (
    RSV_CODE NUMBER(2) PRIMARY KEY,
    RSV_MEMNICKNAME VARCHAR2(15) NOT NULL,
    RSV_TIME VARCHAR2(4) NOT NULL,
    RSV_DATE DATE NOT NULL,
    RSV_COUNT CHAR(1) NOT NULL, -- 4 OR 8
    RSV_HOLE CHAR(2) NOT NULL, -- 9 OR 18
    RSV_CADDY CHAR(1) CHECK (RSV_CADDY IN ('3','4')) NOT NULL, -- 3=CADDY〇 / 4=CADDY×
    RSV_CLOTHES CHAR(1) CHECK (RSV_CLOTHES IN ('5','6')) NOT NULL, -- 5=CLOTHES〇 / 6=CLOTHES× 
    RSV_SHOES CHAR(1) CHECK (RSV_SHOES IN ('7','8')) NOT NULL, -- 7=SHOES〇 / 8=SHOES×

    RSV_STATUS CHAR(1) CHECK (RSV_STATUS IN ('T','F')) NOT NULL,
    RSV_PRICE NUMBER(8) NOT NULL,
    FOREIGN KEY (RSV_MEMNICKNAME) REFERENCES MEMBERS (MEM_NICKNAME)
);

CREATE TABLE TIMESLOTS (
    TI_CODE NUMBER(2) PRIMARY KEY,
    TI_DATE VARCHAR2(8) NOT NULL, --YYYYMMDD
    TI_TIME VARCHAR2(4) NOT NULL, --0700
    FOREIGN KEY (TI_CODE) REFERENCES RSVDS (RSV_CODE) on delete cascade
);

--SEQUENCE-----------------------------------------------------------------------
CREATE SEQUENCE PRI_CODE
    START WITH 1
    INCREMENT BY 1
    MINVALUE 1;

CREATE SEQUENCE RSV_CODE
    START WITH 1
    INCREMENT BY 1
    MINVALUE 1;

CREATE SEQUENCE TI_CODE
    START WITH 1
    INCREMENT BY 1
    MINVALUE 1;

COMMIT;